<!DOCTYPE HTML>
<html>

<head>
    <title>You Look Good</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/lightbox.css">
</head>

<body class="is-preload">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-analytics.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-functions.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBRfRzKeFjf6zZAXTGi_A75MUtQoTiS00E",
            authDomain: "rxh-ylg.firebaseapp.com",
            projectId: "rxh-ylg",
            storageBucket: "rxh-ylg.appspot.com",
            messagingSenderId: "327392555562",
            appId: "1:327392555562:web:8c89dcc0b8eb3f29dd4953",
            measurementId: "G-FKXTTMGZKZ"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        const functions = getFunctions(app, "asia-northeast1");
        const form = document.getElementById("form");
        const submit = document.getElementById("submit");
        const err = document.getElementById("error");
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            submit.classList.add("disabled");

            const password = document.getElementById("password").value;
            const signin = httpsCallable(functions, "signin");
            signin({ password }).
                then((result) => {
                    const data = result.data;
                    if (data.id) {
                        localStorage.setItem("session", data.id);
                        location.href = "/contents.html"
                    }
                }).
                catch((error) => {
                    console.error(error.code, error.message, error.details);
                    submit.classList.remove("disabled");
                    if (error.code === "functions/invalid-argument") {
                        err.innerText = "パスワードが間違っています"
                    } else {
                        err.innerText = "ログインに失敗しました。何度も表示される場合は時間をおいて試してみてください"
                    }
                })
        })
    </script>

    <!-- Header -->
    <section id="index" class="main special">
        <div class="container">
            <div class="content index-textarea">
                <header class="major">
                    <h1>You Look Good</h1>
                </header>
                <sub>
                こちらは個人が主催する<br>
                某飛行機乗り映画の非公式ファンブック告知サイトです。<br>
                制作・版権元各位とは一切関係ありません。<br>
                18歳未満の方の閲覧はご遠慮ください。<br>
                This site is unofficial by a private individual.<br>
                Any similarity to actual persons, works, or production companies is unintentional.<br>
                Viewers must be 18 years of age or older to view content.
                </sub>
            </div>

            <form id="form" class="content">
                <sub>
                    pass: 英語表記CP名 (8文字) + マッハ目標速度 (2文字)<br>
                    h○○○○○○r○○
                </sub>
                <div class="col-12 form-password">
                    <input type="password" name="password" id="password" />
                </div>
                <sub id="error" class="error-message"></sub>
                <div class="col-12 form-password">
                    <input type="submit" value="take off" id="submit" class="primary" />
                </div>
            </form>
        </div>
    </section>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/lightbox.js"></script>
</body>

</html>